<!doctype html>
<html lang="pt-BR" class="h-full">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Sistema de Controle Financeiro</title>
    <script src="/_sdk/element_sdk.js"></script>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&amp;display=swap" rel="stylesheet">
    <style>
        body {
            box-sizing: border-box;
            font-family: 'Inter', -apple-system, BlinkMacSystemFont, 'Segoe UI', sans-serif;
        }

        .dropdown {
            position: relative;
        }

        .dropdown-menu {
            display: none;
            position: absolute;
            top: 100%;
            left: 0;
            min-width: 200px;
            background: white;
            border-radius: 8px;
            box-shadow: 0 10px 25px rgba(0, 0, 0, 0.15);
            z-index: 1000;
            margin-top: -10px;
            overflow: hidden;
        }

        .dropdown:hover .dropdown-menu {
            display: block;
        }

        .dropdown-item {
            padding: 12px 20px;
            transition: all 0.2s ease;
            cursor: pointer;
            border-bottom: 1px solid #f0f0f0;
        }

        .dropdown-item:last-child {
            border-bottom: none;
        }

        .dropdown-item:hover {
            background: #f8f9fa;
            padding-left: 24px;
        }

        .card {
            transition: all 0.3s ease;
        }

        .card:hover {
            transform: translateY(-4px);
            box-shadow: 0 12px 24px rgba(0, 0, 0, 0.12);
        }

        @keyframes fadeIn {
            from {
                opacity: 0;
                transform: translateY(20px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        .animate-fadeIn {
            animation: fadeIn 0.6s ease-out forwards;
        }

        .stagger-1 { animation-delay: 0.1s; opacity: 0; }
        .stagger-2 { animation-delay: 0.2s; opacity: 0; }
        .stagger-3 { animation-delay: 0.3s; opacity: 0; }
        .stagger-4 { animation-delay: 0.4s; opacity: 0; }
    </style>
    <style>@view-transition { navigation: auto; }</style>
    <script src="/_sdk/data_sdk.js" type="text/javascript"></script>
</head>
<body class="h-full">
<div id="app" class="w-full h-full flex flex-col overflow-auto"><!-- Header -->
    <header id="header" class="w-full shadow-md">
        <div class="max-w-7xl mx-auto px-6 py-4">
            <div class="flex items-center justify-between">
                <h1 id="system-title" class="font-bold text-2xl">üí∞ Sistema de Controle Financeiro</h1>
                <div class="flex items-center gap-2" onclick="logout()"><span class="w-20 h-10 rounded-full flex items-center justify-center font-semibold text-lg cursor-pointer">Sairüö™Ô∏è</span>
                </div>
            </div>
        </div>
    </header><!-- Navigation Menu -->
    <nav id="nav" class="w-full shadow-sm">
        <div class="max-w-7xl mx-auto px-6">
            <ul class="flex gap-1">
                <li class="dropdown"><button class="px-4 py-3 font-medium rounded-t-lg transition-all hover:bg-opacity-90"> üë§ Perfil </button>
                    <div class="dropdown-menu">
                        <div class="dropdown-item" onclick="handleAction('perfil', 'editar')"><span class="mr-2">‚úèÔ∏è</span> Editar
                        </div>
                        <div class="dropdown-item" onclick="handleAction('perfil', 'excluir')"><span class="mr-2">üóëÔ∏è</span> Excluir
                        </div>
                    </div></li>
                <li class="dropdown"><button class="px-4 py-3 font-medium rounded-t-lg transition-all hover:bg-opacity-90"> üè¶ Banco </button>
                    <div class="dropdown-menu">
                        <div class="dropdown-item" onclick="handleAction('banco', 'incluir')"><span class="mr-2">‚ûï</span> Incluir
                        </div>
                        <div class="dropdown-item" onclick="handleAction('banco', 'listar')"><span class="mr-2">üìù</span> Listar
                        </div>
                    </div></li>
                <li class="dropdown"><button class="px-4 py-3 font-medium rounded-t-lg transition-all hover:bg-opacity-90"> üí≥ Cart√£o de Cr√©dito </button>
                    <div class="dropdown-menu">
                        <div class="dropdown-item" onclick="handleAction('cartao', 'incluir')"><span class="mr-2">‚ûï</span> Incluir
                        </div>
                        <div class="dropdown-item" onclick="handleAction('cartao', 'editar')"><span class="mr-2">‚úèÔ∏è</span> Editar
                        </div>
                        <div class="dropdown-item" onclick="handleAction('cartao', 'excluir')"><span class="mr-2">üóëÔ∏è</span> Excluir
                        </div>
                    </div></li>
                <li class="dropdown"><button class="px-4 py-3 font-medium rounded-t-lg transition-all hover:bg-opacity-90"> üìä Investimento </button>
                    <div class="dropdown-menu">
                        <div class="dropdown-item" onclick="handleAction('investimentos', 'incluir')"><span class="mr-2">‚ûï</span> Incluir
                        </div>
                        <div class="dropdown-item" onclick="handleAction('investimentos', 'editar')"><span class="mr-2">‚úèÔ∏è</span> Editar
                        </div>
                        <div class="dropdown-item" onclick="handleAction('investimentos', 'excluir')"><span class="mr-2">üóëÔ∏è</span> Excluir
                        </div>
                    </div></li>
            </ul>
        </div>
    </nav><!-- Main Content -->
    <main class="flex-1 w-full">
        <div class="max-w-7xl mx-auto px-6 py-8">
            <div id="welcome-section" class="mb-8">
                <h2 id="welcome-message" class="text-3xl font-bold mb-2">Bem-vindo ao seu painel financeiro</h2>
                <p id="dashboard-subtitle" class="text-lg opacity-80">Gerencie suas finan√ßas de forma inteligente</p>
            </div><!-- Action Feedback Area -->
            <div id="action-feedback" class="rounded-xl p-6 shadow-lg hidden">
                <div class="flex items-start gap-4"><span class="text-3xl" id="feedback-icon">‚úÖ</span>
                    <div class="flex-1">
                        <h3 class="font-bold text-lg mb-2" id="feedback-title">A√ß√£o Selecionada</h3>
                        <p id="feedback-message" class="opacity-80 mb-2"></p>
                        <div id="action-content"></div>
                    </div>
                </div>
            </div>
        </div>
    </main><!-- Footer -->
    <footer id="footer" class="w-full py-4 text-center text-sm opacity-75 border-t">
        <p>¬© 2024 Sistema de Controle Financeiro. Todos os direitos reservados.</p>
    </footer>
</div>
<script>
    function cancelAction() {
        const feedbackArea = document.getElementById('action-feedback');
        feedbackArea.classList.add('hidden');
    }

    const defaultConfig = {
        background_color: "#f8f9fa",
        header_color: "#1e3a8a",
        nav_color: "#3b82f6",
        card_color: "#ffffff",
        text_color: "#1f2937",
        system_title: "Sistema de Controle Financeiro",
        welcome_message: "Bem-vindo ao seu painel financeiro",
        dashboard_subtitle: "Gerencie suas finan√ßas de forma inteligente"
    };

    async function onConfigChange(config) {
        const app = document.getElementById('app');
        const header = document.getElementById('header');
        const nav = document.getElementById('nav');
        const cards = document.querySelectorAll('.card');
        const footer = document.getElementById('footer');
        const dropdownButtons = document.querySelectorAll('.dropdown button');
        const feedbackArea = document.getElementById('action-feedback');

        const backgroundColor = config.background_color || defaultConfig.background_color;
        const headerColor = config.header_color || defaultConfig.header_color;
        const navColor = config.nav_color || defaultConfig.nav_color;
        const cardColor = config.card_color || defaultConfig.card_color;
        const textColor = config.text_color || defaultConfig.text_color;

        app.style.background = backgroundColor;
        app.style.color = textColor;

        header.style.background = headerColor;
        header.style.color = '#ffffff';

        nav.style.background = navColor;

        dropdownButtons.forEach(btn => {
            btn.style.color = '#ffffff';
        });

        cards.forEach(card => {
            card.style.background = cardColor;
            card.style.color = textColor;
        });

        feedbackArea.style.background = cardColor;
        feedbackArea.style.color = textColor;

        footer.style.borderColor = textColor + '20';

        document.getElementById('system-title').textContent = config.system_title || defaultConfig.system_title;
        document.getElementById('welcome-message').textContent = config.welcome_message || defaultConfig.welcome_message;
        document.getElementById('dashboard-subtitle').textContent = config.dashboard_subtitle || defaultConfig.dashboard_subtitle;
    }

    async function carregarUsuario(id) {
        try {
            const response = await fetch(`http://localhost:8080/user/${id}`);
            if (!response.ok) {
                throw new Error("Erro ao buscar usu√°rio");
            }
            const usuario = await response.json();
            preencherCamposPerfil(usuario);
        } catch (error) {
            console.error(error);
            document.getElementById("feedback-message").innerText = "‚ùå N√£o foi poss√≠vel carregar os dados.";
        }
    }

    function preencherCamposPerfil(usuario) {
        try {
            document.getElementById("nome").value = usuario.nome;
            document.getElementById("email").value = usuario.email;
            document.getElementById("cadastroUsuario").value = usuario.usuario;
            document.getElementById("cadastroSenha").value = usuario.senha;
            document.getElementById("cadastroSenhaConfirm").value = usuario.senha;
        } catch (error) {
            console.error(error);
        }
    }

    let currentPageBanco = 0;
    const pageSizeBanco = 5;
    const sortByBanco = "nome";

    async function carregarBancos(page) {
        try {
            const response = await fetch(`http://localhost:8080/bancos?page=${page}&size=${pageSizeBanco}&sortBy=${sortByBanco}`);
            if (!response.ok) throw new Error("Erro ao buscar bancos");

            const data = await response.json(); // objeto Page do Spring
            const lista = document.getElementById("lista-bancos");
            lista.innerHTML = "";

            // renderiza os bancos
            data.content.forEach(banco => {
                const li = document.createElement("li");
                li.textContent = `${banco.id} - ${banco.nome}`;
                lista.appendChild(li);
            });

            // atualiza info de pagina√ß√£o
            document.getElementById("pageInfo").innerText =
                `P√°gina ${data.number + 1} de ${data.totalPages}`;

            // controla bot√µes
            document.getElementById("prevBtn").disabled = data.first;
            document.getElementById("nextBtn").disabled = data.last;

            currentPageBanco = data.number;
        } catch (error) {
            document.getElementById("lista-bancos").innerHTML =
                "<li>‚ùå N√£o foi poss√≠vel carregar os bancos.</li>";
        }

        // eventos dos bot√µes
        document.getElementById("prevBtn").addEventListener("click", () => {
            if (currentPageBanco > 0) carregarBancos(currentPageBanco - 1);
        });

        document.getElementById("nextBtn").addEventListener("click", () => {
            carregarBancos(currentPageBanco + 1);
        });
    }
    function handleAction(modulo, acao) {
        const feedbackArea = document.getElementById('action-feedback');
        const feedbackIcon = document.getElementById('feedback-icon');
        const feedbackTitle = document.getElementById('feedback-title');
        const feedbackMessage = document.getElementById('feedback-message');

        const moduloNomes = {
            perfil: 'Perfil',
            banco: 'Banco',
            cartao: 'Cart√£o de Cr√©dito',
            investimentos: 'Investimentos'
        };

        const acaoNomes = {
            incluir: 'Inclus√£o',
            editar: 'Edi√ß√£o',
            excluir: 'Exclus√£o',
            listar: 'Listar'
        };

        const icons = {
            incluir: '‚ûï',
            editar: '‚úèÔ∏è',
            excluir: 'üóëÔ∏è',
            listar: 'üìù'
        };

        feedbackIcon.textContent = icons[acao];
        feedbackTitle.textContent = `${acaoNomes[acao]} de ${moduloNomes[modulo]}`;
        feedbackMessage.textContent = `Voc√™ selecionou a op√ß√£o de ${acaoNomes[acao].toLowerCase()} para o m√≥dulo ${moduloNomes[modulo]}.`;

        console.log("Entrei no handleAction.")
        // No caso de edi√ß√£o ou exclus√£o, carregar os dados
        console.log("acao = " + acao)
        console.log("modulo = " + modulo)
        if (acao === "editar" || acao === "excluir") {
            console.log("A a√ß√£o √© Edi√ß√£o ou Exclus√£o")
            if (modulo === "perfil") {
                console.log("O m√≥dulo √© Perfil")
                const usuarioLogado = sessionStorage.getItem("usuarioLogado");
                carregarUsuario(usuarioLogado);
            }
        }

        // Carrega outro arquivo HTML e insere no DIV
        fetch(modulo.toLowerCase()+"/"+acao.toLowerCase()+".html")
            .then(response => response.text())
            .then(data => {
                document.getElementById("action-content").innerHTML = data;
            })
            .catch(error => console.error("Erro ao carregar:", error));

        feedbackArea.classList.remove('hidden');
        feedbackArea.scrollIntoView({ behavior: 'smooth', block: 'nearest' });
    }

    document.addEventListener("DOMContentLoaded", handleAction);

    if (window.elementSdk) {
        window.elementSdk.init({
            defaultConfig,
            onConfigChange,
            mapToCapabilities: (config) => ({
                recolorables: [
                    {
                        get: () => config.background_color || defaultConfig.background_color,
                        set: (value) => {
                            config.background_color = value;
                            window.elementSdk.setConfig({ background_color: value });
                        }
                    },
                    {
                        get: () => config.header_color || defaultConfig.header_color,
                        set: (value) => {
                            config.header_color = value;
                            window.elementSdk.setConfig({ header_color: value });
                        }
                    },
                    {
                        get: () => config.nav_color || defaultConfig.nav_color,
                        set: (value) => {
                            config.nav_color = value;
                            window.elementSdk.setConfig({ nav_color: value });
                        }
                    },
                    {
                        get: () => config.card_color || defaultConfig.card_color,
                        set: (value) => {
                            config.card_color = value;
                            window.elementSdk.setConfig({ card_color: value });
                        }
                    },
                    {
                        get: () => config.text_color || defaultConfig.text_color,
                        set: (value) => {
                            config.text_color = value;
                            window.elementSdk.setConfig({ text_color: value });
                        }
                    }
                ],
                borderables: [],
                fontEditable: undefined,
                fontSizeable: undefined
            }),
            mapToEditPanelValues: (config) => new Map([
                ["system_title", config.system_title || defaultConfig.system_title],
                ["welcome_message", config.welcome_message || defaultConfig.welcome_message],
                ["dashboard_subtitle", config.dashboard_subtitle || defaultConfig.dashboard_subtitle]
            ])
        });
    }

    onConfigChange(defaultConfig);

    function verificaUsuarioLogado() {
        const usuarioLogado = sessionStorage.getItem("usuarioLogado");
        if (!usuarioLogado) {
            sessionStorage.setItem("signupSuccess", "‚ùå Usu√°rio n√£o logado. Favor logar novamente.");
            window.location.href = "index.html";
        }
    }
    document.addEventListener("DOMContentLoaded", () => {
        verificaUsuarioLogado();
    });

    async function salvarEdicao() {
        // pega os campos
        const nome = document.getElementById("nome");
        const email = document.getElementById("email");
        const usuario = document.getElementById("cadastroUsuario");
        const senha = document.getElementById("cadastroSenha");
        const senhaConfirm = document.getElementById("cadastroSenhaConfirm");

        // remove erros anteriores
        [nome, email, usuario, senha, senhaConfirm].forEach(campo => campo.classList.remove("input-error"));

        let valido = true;

        // valida campos obrigat√≥rios
        [nome, email, usuario, senha, senhaConfirm].forEach(campo => {
            if (!campo.value.trim()) {
                campo.classList.add("input-error"); // aplica borda/sublinhado vermelho
                valido = false;
            }
        });

        // valida senha
        if (senha.value.trim() !== senhaConfirm.value.trim()) {
            senha.classList.add("input-error");
            senhaConfirm.classList.add("input-error");
            document.getElementById("feedback-message").innerText = "‚ö†Ô∏è As senhas n√£o conferem.";
            valido = false;
        }

        if (!valido) {
            document.getElementById("feedback-message").innerText = "‚ö†Ô∏è Preencha todos os campos corretamente.";
            return;
        }

        // se passou na valida√ß√£o, envia
        const user = {
            nome: nome.value.trim(),
            email: email.value.trim(),
            usuario: usuario.value.trim(),
            senha: senha.value.trim()
        };

        try {
            const usuarioLogado = sessionStorage.getItem("usuarioLogado");
            if (!usuarioLogado) {
                sessionStorage.setItem("signupSuccess", "‚ùå Usu√°rio n√£o logado. Favor logar novamente.");
                window.location.href = "index.html";
            }
            const response = await fetch("http://localhost:8080/user/" + usuarioLogado, {
                method: "PUT",
                headers: {"Content-Type": "application/json"},
                body: JSON.stringify(user)
            });

            if (response.ok) {
                const mensagem = await response.text();
                document.getElementById("feedback-message").innerText = "‚úÖ Conta atualizada com sucesso!";
            } else {
                document.getElementById("feedback-message").innerText = "‚ùå Erro ao criar conta. Tente novamente.";
            }
        } catch (error) {
            document.getElementById("feedback-message").innerText = "‚ùå Falha na conex√£o com o servidor.";
        }
    }

    async function salvarExclusao() {
        console.log("salvarExclusao");
        const resposta = confirm("Deseja realmente excluir o perfil e perder o acesso ao sistema?");
        if (!resposta) {
            // usu√°rio clicou em Cancelar
            document.getElementById("feedback-message").innerText = "‚ö†Ô∏è A exclus√£o de perfil foi cancelada.";
            return;
        }

        try {
            const usuarioLogado = sessionStorage.getItem("usuarioLogado");
            if (!usuarioLogado) {
                sessionStorage.setItem("signupSuccess", "‚ùå Usu√°rio n√£o logado. Favor logar novamente.");
                window.location.href = "index.html";
            }
            const response = await fetch("http://localhost:8080/user/" + usuarioLogado, {
                method: "DELETE"
            });

            if (response.ok) {
                const mensagem = await response.text();
                sessionStorage.setItem("signupSuccess", "‚úÖ Perfil exclu√≠do com sucesso!");
                window.location.href = "index.html";
            } else {
                document.getElementById("feedback-message").innerText = "‚ùå Erro ao excluir o perfil. Tente novamente.";
            }
        } catch (error) {
            document.getElementById("feedback-message").innerText = "‚ùå Falha na conex√£o com o servidor.";
        }
    }

    (function(){function c(){var b=a.contentDocument||a.contentWindow.document;if(b){var d=b.createElement('script');d.innerHTML="window.__CF$cv$params={r:'9ba50dcd466e5e0f',t:'MTc2NzgwNTY3Mi4wMDAwMDA='};var a=document.createElement('script');a.nonce='';a.src='/cdn-cgi/challenge-platform/scripts/jsd/main.js';document.getElementsByTagName('head')[0].appendChild(a);";b.getElementsByTagName('head')[0].appendChild(d)}}if(document.body){var a=document.createElement('iframe');a.height=1;a.width=1;a.style.position='absolute';a.style.top=0;a.style.left=0;a.style.border='none';a.style.visibility='hidden';document.body.appendChild(a);if('loading'!==document.readyState)c();else if(window.addEventListener)document.addEventListener('DOMContentLoaded',c);else{var e=document.onreadystatechange||function(){};document.onreadystatechange=function(b){e(b);'loading'!==document.readyState&&(document.onreadystatechange=e,c())}}}})();

    function logout() {
        sessionStorage.setItem("signupSuccess", "‚úÖ Perfil exclu√≠do com sucesso!");
        sessionStorage.setItem("usuarioLogado", "");
        window.location.href = "index.html";
    }
</script>
</body>
</html>